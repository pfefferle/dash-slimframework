<!DOCTYPE html>
<html lang="en"><!-- Mirrored from www.slimframework.com/docs/v3/cookbook/action-domain-responder.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 19 Jun 2019 12:43:44 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport"/>
        <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
        <title>Action-Domain-Responder with Slim - Slim Framework</title>
        <meta content="" name="description"/>
        <meta content="index, follow" name="robots"/>
        <meta content="Action-Domain-Responder with Slim" property="og:title"/>
        <meta content="Slim Framework" property="og:site_name"/>
        <meta content="action-domain-responder.html" property="og:url"/>
        <meta content="" property="og:description"/>
        <meta content="website" property="og:type"/>
        <!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
        <link href="../../../assets/css/all.css" rel="stylesheet"/>
        <link href="../../../assets/images/favicon.png" rel="shortcut icon"/>
        <link href="../../../../maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
        
        
        
    </head>
    <body style="padding-top: 5em">
        

<div class="wrapper docs">
    <div class="container-fluid">
        

        <div class="row">
            

            <div class="col-md-8 docs-content">
                <h1 class="page-header"><a class="dashAnchor" name="//apple_ref/cpp/Section/Action-Domain-Responder%20with%20Slim"></a>Action-Domain-Responder with Slim</h1>
                <div class="edit-panel" style="margin: 0 0 1em 0;">
                    <a class="btn btn-default btn-sm" href="https://github.com/slimphp/Slim-Website/tree/gh-pages/docs/v3/cookbook/action-domain-responder.md" role="button" target="_blank"><i class="fa fa-github"></i> Edit This Page</a>
                    
                </div>
                <p>In this post, I’ll show how to refactor the Slim tutorial application to more closely follow the <a href="http://pmjones.io/adr">Action-Domain-Responder</a> pattern.</p>

<p>One nice thing about Slim (and most other <a href="http://paul-m-jones.com/archives/6627">HTTP user interface frameworks</a>) is that they are already “action” oriented. That is, their routers do not presume a controller class with many action methods. Instead, they presume an action closure or a single-action invokable class.</p>

<p>So the Action part of Action-Domain-Responder already exists for Slim. All that is needed is to pull extraneous bits out of the Actions, to more clearly separate the Action behaviors from Domain and the Responder behaviors.</p>

<h2 id="extract-domain"><a class="dashAnchor" name="//apple_ref/cpp/Section/Extract%20Domain"></a>Extract Domain</h2>

<p>Let’s begin by extracting the Domain logic. In the original tutorial, the Actions use two data-source mappers directly, and embed some business logic as well. We can create a Service Layer class called <code class="highlighter-rouge">TicketService</code> and move those operations from the Actions into the Domain. Doing so gives us this class:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TicketService</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$ticket_mapper</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$component_mapper</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span>
        <span class="nx">TicketMapper</span> <span class="nv">$ticket_mapper</span><span class="p">,</span>
        <span class="nx">ComponentMapper</span> <span class="nv">$component_mapper</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_mapper</span> <span class="o">=</span> <span class="nv">$ticket_mapper</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component_mapper</span> <span class="o">=</span> <span class="nv">$component_mapper</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTickets</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_mapper</span><span class="o">-&gt;</span><span class="na">getTickets</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getComponents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component_mapper</span><span class="o">-&gt;</span><span class="na">getComponents</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTicketById</span><span class="p">(</span><span class="nv">$ticket_id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$ticket_id</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$ticket_id</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_mapper</span><span class="o">-&gt;</span><span class="na">getTicketById</span><span class="p">(</span><span class="nv">$ticket_id</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">createTicket</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$component_id</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'component'</span><span class="p">];</span>
        <span class="nv">$component</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component_mapper</span><span class="o">-&gt;</span><span class="na">getComponentById</span><span class="p">(</span><span class="nv">$component_id</span><span class="p">);</span>

        <span class="nv">$ticket_data</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nv">$ticket_data</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter_var</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'title'</span><span class="p">],</span> <span class="nx">FILTER_SANITIZE_STRING</span><span class="p">);</span>
        <span class="nv">$ticket_data</span><span class="p">[</span><span class="s1">'description'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter_var</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'description'</span><span class="p">],</span> <span class="nx">FILTER_SANITIZE_STRING</span><span class="p">);</span>
        <span class="nv">$ticket_data</span><span class="p">[</span><span class="s1">'component'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$component</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">();</span>

        <span class="nv">$ticket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TicketEntity</span><span class="p">(</span><span class="nv">$ticket_data</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_mapper</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$ticket</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$ticket</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We create a container object for it in <code class="highlighter-rouge">index.php</code> like so:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$container</span><span class="p">[</span><span class="s1">'ticket_service'</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">TicketService</span><span class="p">(</span>
        <span class="k">new</span> <span class="nx">TicketMapper</span><span class="p">(</span><span class="nv">$c</span><span class="p">[</span><span class="s1">'db'</span><span class="p">]),</span>
        <span class="k">new</span> <span class="nx">ComponentMapper</span><span class="p">(</span><span class="nv">$c</span><span class="p">[</span><span class="s1">'db'</span><span class="p">])</span>
    <span class="p">);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>And now the Actions can use the <code class="highlighter-rouge">TicketService</code> instead of performing domain logic directly:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'/tickets'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Response</span> <span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logger</span><span class="o">-&gt;</span><span class="na">addInfo</span><span class="p">(</span><span class="s2">"Ticket list"</span><span class="p">);</span>
    <span class="nv">$tickets</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_service</span><span class="o">-&gt;</span><span class="na">getTickets</span><span class="p">();</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span>
        <span class="nv">$response</span><span class="p">,</span>
        <span class="s2">"tickets.phtml"</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">"tickets"</span> <span class="o">=&gt;</span> <span class="nv">$tickets</span><span class="p">,</span> <span class="s2">"router"</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">router</span><span class="p">]</span>
    <span class="p">);</span>
    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'/ticket/new'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Response</span> <span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$components</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_service</span><span class="o">-&gt;</span><span class="na">getComponents</span><span class="p">();</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span>
        <span class="nv">$response</span><span class="p">,</span>
        <span class="s2">"ticketadd.phtml"</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">"components"</span> <span class="o">=&gt;</span> <span class="nv">$components</span><span class="p">]</span>
    <span class="p">);</span>
    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">'/ticket/new'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Response</span> <span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getParsedBody</span><span class="p">();</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_service</span><span class="o">-&gt;</span><span class="na">createTicket</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">withRedirect</span><span class="p">(</span><span class="s2">"/tickets"</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'/ticket/{id}'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Response</span> <span class="nv">$response</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$ticket</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_service</span><span class="o">-&gt;</span><span class="na">getTicketById</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]);</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span>
        <span class="nv">$response</span><span class="p">,</span>
        <span class="s2">"ticketdetail.phtml"</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">"ticket"</span> <span class="o">=&gt;</span> <span class="nv">$ticket</span><span class="p">]</span>
    <span class="p">);</span>
    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">'ticket-detail'</span><span class="p">);</span>
</code></pre></div></div>

<p>One benefit here is that we can now test the domain activities separately from the actions. We can begin to do something more like integration testing, even unit testing, instead of end-to-end system testing.</p>

<h2 id="extract-responder"><a class="dashAnchor" name="//apple_ref/cpp/Section/Extract%20Responder"></a>Extract Responder</h2>

<p>In the case of the tutorial application, the presentation work is so straightforward as to not require a separate Responder for each action. A relaxed variation of a Responder layer is perfectly suitable in this simple case, one where each Action uses a different method on a common Responder.</p>

<p>Extracting the presentation work to a separate Responder, so that response-building is completely removed from the Action, looks like this:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nx">Psr\Http\Message\ResponseInterface</span> <span class="k">as</span> <span class="nx">Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Slim\Views\PhpRenderer</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TicketResponder</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$view</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">PhpRenderer</span> <span class="nv">$view</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span> <span class="o">=</span> <span class="nv">$view</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Response</span> <span class="nv">$response</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span>
            <span class="nv">$response</span><span class="p">,</span>
            <span class="s2">"tickets.phtml"</span><span class="p">,</span>
            <span class="nv">$data</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">detail</span><span class="p">(</span><span class="nx">Response</span> <span class="nv">$response</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span>
            <span class="nv">$response</span><span class="p">,</span>
            <span class="s2">"ticketdetail.phtml"</span><span class="p">,</span>
            <span class="nv">$data</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="nx">Response</span> <span class="nv">$response</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">view</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span>
            <span class="nv">$response</span><span class="p">,</span>
            <span class="s2">"ticketadd.phtml"</span><span class="p">,</span>
            <span class="nv">$data</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">create</span><span class="p">(</span><span class="nx">Response</span> <span class="nv">$response</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">withRedirect</span><span class="p">(</span><span class="s2">"/tickets"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can then add the <code class="highlighter-rouge">TicketResponder</code> object to the container in <code class="highlighter-rouge">index.php</code>:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$container</span><span class="p">[</span><span class="s1">'ticket_responder'</span><span class="p">]</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">TicketResponder</span><span class="p">(</span><span class="nv">$c</span><span class="p">[</span><span class="s1">'view'</span><span class="p">]);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>And finally we can refer to the Responder, instead of just the template system, in the Actions:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'/tickets'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Response</span> <span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logger</span><span class="o">-&gt;</span><span class="na">addInfo</span><span class="p">(</span><span class="s2">"Ticket list"</span><span class="p">);</span>
    <span class="nv">$tickets</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_service</span><span class="o">-&gt;</span><span class="na">getTickets</span><span class="p">();</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_responder</span><span class="o">-&gt;</span><span class="na">index</span><span class="p">(</span>
        <span class="nv">$response</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">"tickets"</span> <span class="o">=&gt;</span> <span class="nv">$tickets</span><span class="p">,</span> <span class="s2">"router"</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">router</span><span class="p">]</span>
    <span class="p">);</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'/ticket/new'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Response</span> <span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$components</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_service</span><span class="o">-&gt;</span><span class="na">getComponents</span><span class="p">();</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_responder</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span>
        <span class="nv">$response</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">"components"</span> <span class="o">=&gt;</span> <span class="nv">$components</span><span class="p">]</span>
    <span class="p">);</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">'/ticket/new'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Response</span> <span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getParsedBody</span><span class="p">();</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_service</span><span class="o">-&gt;</span><span class="na">createTicket</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_responder</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'/ticket/{id}'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Response</span> <span class="nv">$response</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$ticket</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_service</span><span class="o">-&gt;</span><span class="na">getTicketById</span><span class="p">(</span><span class="nv">$args</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]);</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">ticket_responder</span><span class="o">-&gt;</span><span class="na">detail</span><span class="p">(</span>
        <span class="nv">$response</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">"ticket"</span> <span class="o">=&gt;</span> <span class="nv">$ticket</span><span class="p">]</span>
    <span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">'ticket-detail'</span><span class="p">);</span>
</code></pre></div></div>

<p>Now we can test the response-building work separately from the domain work.</p>

<p>Some notes:</p>

<p>Putting all the response-building in a single class with multiple methods, especially for simple cases like this tutorial, is fine to start with. For ADR, is not strictly necessary to have one Responder for each Action. What <em>is</em> necessary is to extract the response-building concerns out of the Action.</p>

<p>But as the presentation logic complexity increases (content-type negotiation? status headers? etc.), and as dependencies become different for each kind of response being built, you will want to have a Responder for each Action.</p>

<p>Alternatively, you might stick with a single Responder, but reduce its interface to a single method. In that case, you may find that using a <a href="http://paul-m-jones.com/archives/6043">Domain Payload</a> (instead of “naked” domain results) has some significant benefits.</p>

<h2 id="conclusion"><a class="dashAnchor" name="//apple_ref/cpp/Section/Conclusion"></a>Conclusion</h2>

<p>At this point, the Slim tutorial application has been converted to ADR. We have separated the domain logic to a <code class="highlighter-rouge">TicketService</code>, and the presentation logic to a <code class="highlighter-rouge">TicketResponder</code>. And it’s easy to see how each Action does pretty much the same thing:</p>

<ul>
  <li>Marshals input and passes it into the Domain</li>
  <li>Gets back a result from the Domain and passes it to the Responder</li>
  <li>Invokes the Responder so it can build and return the Response</li>
</ul>

<p>Now, for a simple case like this, using ADR (or even webbishy MVC) might seem like overkill. But simple cases become complex quickly, and this simple case shows how the ADR separation-of-concerns can be applied as a Slim-based application increases in complexity.</p>


                <nav>
                    <ul class="nav pager">
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                
                                    
                                        <li class="previous">
                                            <a href="uploading-files.html" rel="prev"><i class="fa fa-arrow-left"></i> <small>Cook book: </small> Uploading Files using POST forms</a>
                                        </li>
                                    
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                
                                    <li class="next">
                                        <a href="../features/templates.html" rel="next"><small>Add Ons: </small> Templates <i class="fa fa-arrow-right"></i></a>
                                    </li>
                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                    </ul>
                </nav>
            </div>
        </div>

        <footer class="site-footer">
            <p>
                Created and maintained by <br/>
                <a href="http://joshlockhart.com/">Josh Lockhart</a>,
                <a href="http://www.silentworks.co.uk/" target="_blank">Andrew Smith</a>,
                <a href="http://akrabat.com/" target="_blank">Rob Allen</a>, and the
                <a href="https://github.com/orgs/slimphp/people" target="_blank">Slim Framework Team</a>
            </p>
            <a alt="Donate with PayPal" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=HNUWP9UUGC7L4">Donate with PayPal</a>
        </footer>
    </div>
</div>
        
        
        
        
            
            
        
        
    




</body><!-- Mirrored from www.slimframework.com/docs/v3/cookbook/action-domain-responder.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 19 Jun 2019 12:43:44 GMT --></html>