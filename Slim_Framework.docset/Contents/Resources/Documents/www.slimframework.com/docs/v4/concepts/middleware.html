<!DOCTYPE html>
<html lang="en"><!-- Mirrored from www.slimframework.com/docs/v4/concepts/middleware.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 04 Dec 2020 20:50:26 GMT --><!-- Added by HTTrack --><head><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->

        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport"/>
        <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
        <title>Middleware - Slim Framework</title>
        <meta content="" name="description"/>
        <meta content="index, follow" name="robots"/>
        <meta content="Middleware" property="og:title"/>
        <meta content="Slim Framework" property="og:site_name"/>
        <meta content="middleware.html" property="og:url"/>
        <meta content="" property="og:description"/>
        <meta content="website" property="og:type"/>
        <!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
        <link href="../../../assets/css/all.css" rel="stylesheet"/>
        <link href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" rel="stylesheet"/>
        <link href="../../../assets/images/favicon.png" rel="shortcut icon"/>
        <link href="../../../../maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
        
        
        
        
    </head>
    <body>
        

<div class="wrapper docs">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="toc-nav-toggle">
                    <button aria-controls="tocNav" aria-expanded="false" class="btn btn-primary" data-target="#tocNav" data-toggle="collapse" type="button">
                        Toggle Navigation
                    </button>
                </div>
                
            </div>

            <div class="col-md-8 docs-content">
                <h1 class="page-header"><a class="dashAnchor" name="//apple_ref/cpp/Section/Middleware"></a>Middleware</h1>
                <div class="edit-panel" style="margin: 0 0 1em 0;">
                    <a class="btn btn-default btn-sm" href="https://github.com/slimphp/Slim-Website/tree/gh-pages/docs/v4/concepts/middleware.md" target="_blank"><i class="fa fa-github"></i> Edit This Page</a>
                </div>
                <p>You can run code <em>before</em> and <em>after</em> your Slim application to manipulate the
Request and Response objects as you see fit. This is called <em>middleware</em>.
Why would you want to do this? Perhaps you want to protect your app
from cross-site request forgery. Maybe you want to authenticate requests
before your app runs. Middleware is perfect for these scenarios.</p>

<h2 id="what-is-middleware"><a class="dashAnchor" name="//apple_ref/cpp/Section/What%20is%20middleware%3F"></a>What is middleware?</h2>

<p>A middleware implements the <a href="https://www.php-fig.org/psr/psr-15/">PSR-15 Middleware Interface</a>:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">Psr\Http\Message\ServerRequestInterface</code> - The PSR-7 request object</li>
  <li><code class="language-plaintext highlighter-rouge">Psr\Http\Server\RequestHandlerInterface</code> - The PSR-15 request handler object</li>
</ol>

<p>It can do whatever is appropriate with these objects. The only hard requirement
is that a middleware <strong>MUST</strong> return an instance of  <code class="language-plaintext highlighter-rouge">Psr\Http\Message\ResponseInterface</code>.
Each middleware <strong>SHOULD</strong> invoke the next middleware and pass it Request and
Response objects as arguments.</p>

<h2 id="how-does-middleware-work"><a class="dashAnchor" name="//apple_ref/cpp/Section/How%20does%20middleware%20work%3F"></a>How does middleware work?</h2>

<p>Different frameworks use middleware differently. Slim adds middleware as concentric
layers surrounding your core application. Each new middleware layer surrounds
any existing middleware layers. The concentric structure expands outwardly as
additional middleware layers are added.</p>

<p>The last middleware layer added is the first to be executed.</p>

<p>When you run the Slim application, the Request object traverses the
middleware structure from the outside in. They first enter the outer-most middleware,
then the next outer-most middleware, (and so on), until they ultimately arrive
at the Slim application itself. After the Slim application dispatches the
appropriate route, the resultant Response object exits the Slim application and
traverses the middleware structure from the inside out. Ultimately, a final
Response object exits the outer-most middleware, is serialized into a raw HTTP
response, and is returned to the HTTP client. Here’s a diagram that illustrates
the middleware process flow:</p>

<div style="padding: 2em 0; text-align: center">
    <img alt="Middleware architecture" src="../images/middleware.png" style="max-width: 80%;"/>
</div>

<h2 id="how-do-i-write-middleware"><a class="dashAnchor" name="//apple_ref/cpp/Section/How%20do%20I%20write%20middleware%3F"></a>How do I write middleware?</h2>

<p>Middleware is a callable that accepts two arguments: a <code class="language-plaintext highlighter-rouge">Request</code> object and a <code class="language-plaintext highlighter-rouge">RequestHandler</code> object. Each middleware <strong>MUST</strong> return an instance of  <code class="language-plaintext highlighter-rouge">Psr\Http\Message\ResponseInterface</code>.</p>

<h3 id="closure-middleware-example"><a class="dashAnchor" name="//apple_ref/cpp/Section/Closure%20middleware%20example."></a>Closure middleware example.</h3>

<p>This example middleware is a Closure.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Message\ServerRequestInterface</span> <span class="k">as</span> <span class="nc">Request</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Server\RequestHandlerInterface</span> <span class="k">as</span> <span class="nc">RequestHandler</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Slim\Factory\AppFactory</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Slim\Psr7\Response</span><span class="p">;</span>

<span class="k">require</span> <span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="nc">AppFactory</span><span class="o">::</span><span class="nf">create</span><span class="p">();</span>

<span class="cd">/**
 * Example middleware closure
 *
 * @param  ServerRequest  $request PSR-7 request
 * @param  RequestHandler $handler PSR-15 request handler
 *
 * @return Response
 */</span>
<span class="nv">$beforeMiddleware</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">RequestHandler</span> <span class="nv">$handler</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$handler</span><span class="o">-&gt;</span><span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="nv">$existingContent</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">();</span>

    <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Response</span><span class="p">();</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="s1">'BEFORE'</span> <span class="mf">.</span> <span class="nv">$existingContent</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">};</span>

<span class="nv">$afterMiddleware</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$handler</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$handler</span><span class="o">-&gt;</span><span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="s1">'AFTER'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">add</span><span class="p">(</span><span class="nv">$beforeMiddleware</span><span class="p">);</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">add</span><span class="p">(</span><span class="nv">$afterMiddleware</span><span class="p">);</span>

<span class="c1">// ...</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">run</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="invokable-class-middleware-example"><a class="dashAnchor" name="//apple_ref/cpp/Section/Invokable%20class%20middleware%20example"></a>Invokable class middleware example</h3>

<p>This example middleware is an invokable class that implements the magic <code class="language-plaintext highlighter-rouge">__invoke()</code> method.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Message\ServerRequestInterface</span> <span class="k">as</span> <span class="nc">Request</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Server\RequestHandlerInterface</span> <span class="k">as</span> <span class="nc">RequestHandler</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Slim\Psr7\Response</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ExampleBeforeMiddleware</span>
<span class="p">{</span>
    <span class="cd">/**
     * Example middleware invokable class
     *
     * @param  ServerRequest  $request PSR-7 request
     * @param  RequestHandler $handler PSR-15 request handler
     *
     * @return Response
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__invoke</span><span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">RequestHandler</span> <span class="nv">$handler</span><span class="p">):</span> <span class="kt">Response</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$handler</span><span class="o">-&gt;</span><span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="nv">$existingContent</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">();</span>
    
        <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Response</span><span class="p">();</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="s1">'BEFORE'</span> <span class="mf">.</span> <span class="nv">$existingContent</span><span class="p">);</span>
    
        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Message\ResponseInterface</span> <span class="k">as</span> <span class="nc">Response</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Message\ServerRequestInterface</span> <span class="k">as</span> <span class="nc">Request</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Server\RequestHandlerInterface</span> <span class="k">as</span> <span class="nc">RequestHandler</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ExampleAfterMiddleware</span>
<span class="p">{</span>
    <span class="cd">/**
     * Example middleware invokable class
     *
     * @param  ServerRequest  $request PSR-7 request
     * @param  RequestHandler $handler PSR-15 request handler
     *
     * @return Response
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__invoke</span><span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">RequestHandler</span> <span class="nv">$handler</span><span class="p">):</span> <span class="kt">Response</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$handler</span><span class="o">-&gt;</span><span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="s1">'AFTER'</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To use these classes as a middleware, you can use <strong>add(new ExampleMiddleware());</strong> function chain after the <strong>$app</strong> route mapping methods <strong>get(), post(), put(), patch(), delete(), options(), any()</strong>  or <strong>group()</strong>, which in the code below, any one of these, could represent $subject.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">use</span> <span class="nc">Slim\Factory\AppFactory</span><span class="p">;</span>

<span class="k">require</span> <span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="nc">AppFactory</span><span class="o">::</span><span class="nf">create</span><span class="p">();</span>

<span class="c1">// Add Middleware On App</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">add</span><span class="p">(</span><span class="k">new</span> <span class="nc">ExampleMiddleware</span><span class="p">());</span>

<span class="c1">// Add Middleware On Route</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span> <span class="mf">...</span> <span class="p">})</span><span class="o">-&gt;</span><span class="nf">add</span><span class="p">(</span><span class="k">new</span> <span class="nc">ExampleMiddleware</span><span class="p">());</span>

<span class="c1">// Add Middleware On Group</span>
<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">group</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span> <span class="mf">...</span> <span class="p">})</span><span class="o">-&gt;</span><span class="nf">add</span><span class="p">(</span><span class="k">new</span> <span class="nc">ExampleMiddleware</span><span class="p">());</span>

<span class="c1">// ...</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">run</span><span class="p">();</span>
</code></pre></div></div>

<h2 id="how-do-i-add-middleware"><a class="dashAnchor" name="//apple_ref/cpp/Section/How%20do%20I%20add%20middleware%3F"></a>How do I add middleware?</h2>

<p>You may add middleware to a Slim application, to an individual Slim application route or to a route group. All scenarios accept the same middleware and implement the same middleware interface.</p>

<h3 id="application-middleware"><a class="dashAnchor" name="//apple_ref/cpp/Section/Application%20middleware"></a>Application middleware</h3>

<p>Application middleware is invoked for every <strong>incoming</strong> HTTP request. Add application middleware with the Slim application instance’s <strong>add()</strong> method. This example adds the Closure middleware example above:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Message\ServerRequestInterface</span> <span class="k">as</span> <span class="nc">Request</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Server\RequestHandlerInterface</span> <span class="k">as</span> <span class="nc">RequestHandler</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Slim\Factory\AppFactory</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Slim\Psr7\Response</span><span class="p">;</span>

<span class="k">require</span> <span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="nc">AppFactory</span><span class="o">::</span><span class="nf">create</span><span class="p">();</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">add</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">RequestHandler</span> <span class="nv">$handler</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$handler</span><span class="o">-&gt;</span><span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="nv">$existingContent</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">();</span>

    <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Response</span><span class="p">();</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="s1">'BEFORE '</span> <span class="mf">.</span> <span class="nv">$existingContent</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">add</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">RequestHandler</span> <span class="nv">$handler</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$handler</span><span class="o">-&gt;</span><span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="s1">' AFTER'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">Response</span> <span class="nv">$response</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="s1">'Hello World'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">run</span><span class="p">();</span>
</code></pre></div></div>

<p>This would output this HTTP response body:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BEFORE Hello World AFTER
</code></pre></div></div>

<h3 id="route-middleware"><a class="dashAnchor" name="//apple_ref/cpp/Section/Route%20middleware"></a>Route middleware</h3>

<p>Route middleware is invoked <em>only if</em> its route matches the current HTTP request method and URI. Route middleware is specified immediately after you invoke any of the Slim application’s routing methods (e.g., <strong>get()</strong> or <strong>post()</strong>). Each routing method returns an instance of <strong>\Slim\Route</strong>, and this class provides the same middleware interface as the Slim application instance. Add middleware to a Route with the Route instance’s <strong>add()</strong> method. This example adds the Closure middleware example above:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Message\ResponseInterface</span> <span class="k">as</span> <span class="nc">Response</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Message\ServerRequestInterface</span> <span class="k">as</span> <span class="nc">Request</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Server\RequestHandlerInterface</span> <span class="k">as</span> <span class="nc">RequestHandler</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Slim\Factory\AppFactory</span><span class="p">;</span>

<span class="k">require</span> <span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="nc">AppFactory</span><span class="o">::</span><span class="nf">create</span><span class="p">();</span>

<span class="nv">$mw</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">RequestHandler</span> <span class="nv">$handler</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$handler</span><span class="o">-&gt;</span><span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="s1">'World'</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">};</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">Response</span> <span class="nv">$response</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="s1">'Hello '</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nf">add</span><span class="p">(</span><span class="nv">$mw</span><span class="p">);</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">run</span><span class="p">();</span>
</code></pre></div></div>

<p>This would output this HTTP response body:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello World
</code></pre></div></div>

<h3 id="group-middleware"><a class="dashAnchor" name="//apple_ref/cpp/Section/Group%20middleware"></a>Group middleware</h3>

<p>In addition to the overall application, and standard routes being able to accept middleware, the <strong>group()</strong> multi-route definition functionality, also allows individual routes internally. Route group middleware is invoked <em>only if</em> its route matches one of the defined HTTP request methods and URIs from the group. To add middleware within the callback, and entire-group middleware to be set by chaining <strong>add()</strong> after the <strong>group()</strong> method.</p>

<p>Sample Application, making use of callback middleware on a group of url-handlers</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Message\ResponseInterface</span> <span class="k">as</span> <span class="nc">Response</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Message\ServerRequestInterface</span> <span class="k">as</span> <span class="nc">Request</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Psr\Http\Server\RequestHandlerInterface</span> <span class="k">as</span> <span class="nc">RequestHandler</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Slim\Factory\AppFactory</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Slim\Routing\RouteCollectorProxy</span><span class="p">;</span>

<span class="k">require</span> <span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="nc">AppFactory</span><span class="o">::</span><span class="nf">create</span><span class="p">();</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">Response</span> <span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="s1">'Hello World'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">group</span><span class="p">(</span><span class="s1">'/utils'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">RouteCollectorProxy</span> <span class="nv">$group</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$group</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/date'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">Response</span> <span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s1">'Y-m-d H:i:s'</span><span class="p">));</span>
        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">});</span>
    
    <span class="nv">$group</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/time'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">Response</span> <span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">((</span><span class="n">string</span><span class="p">)</span><span class="nb">time</span><span class="p">());</span>
        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nf">add</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">RequestHandler</span> <span class="nv">$handler</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$handler</span><span class="o">-&gt;</span><span class="nf">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="nv">$dateOrTime</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">();</span>

    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">getResponseFactory</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">createResponse</span><span class="p">();</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="s1">'It is now '</span> <span class="mf">.</span> <span class="nv">$dateOrTime</span> <span class="mf">.</span> <span class="s1">'. Enjoy!'</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">});</span>

<span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">run</span><span class="p">();</span>
</code></pre></div></div>

<p>When calling the <strong>/utils/date</strong> method, this would output a string similar to the below</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>It is now 2015-07-06 03:11:01. Enjoy!
</code></pre></div></div>

<p>Visiting <strong>/utils/time</strong> would output a string similar to the below</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>It is now 1436148762. Enjoy!
</code></pre></div></div>

<p>But visiting <strong>/</strong> <em>(domain-root)</em>, would be expected to generate the following output as no middleware has been assigned</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello World
</code></pre></div></div>

<h3 id="passing-variables-from-middleware"><a class="dashAnchor" name="//apple_ref/cpp/Section/Passing%20variables%20from%20middleware"></a>Passing variables from middleware</h3>
<p>The easiest way to pass attributes from middleware is to use the request’s
attributes.</p>

<p>Setting the variable in the middleware:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$request</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">withAttribute</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">);</span>
</code></pre></div></div>

<p>Getting the variable in the route callback:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$foo</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">getAttribute</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="finding-available-middleware"><a class="dashAnchor" name="//apple_ref/cpp/Section/Finding%20available%20middleware"></a>Finding available middleware</h2>

<p>You may find a PSR-15 Middleware class already written that will satisfy your needs. Here are a few unofficial lists to search.</p>

<ul>
  <li><a href="https://github.com/slimphp/Slim/wiki/Middleware-for-Slim-Framework-v4.x">Middleware for Slim Framework v4.x wiki</a></li>
  <li><a href="https://github.com/middlewares/awesome-psr15-middlewares">middlewares/awesome-psr15-middlewares</a></li>
</ul>


                <nav>
                    <ul class="nav pager">
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                
                                    
                                        <li class="previous">
                                            <a href="value-objects.html" rel="prev"><i class="fa fa-arrow-left"></i> <small>Concepts: </small> PSR-7</a>
                                        </li>
                                    
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                
                                    <li class="next">
                                        <a href="di.html" rel="next"><small>Concepts: </small> Dependency Container <i class="fa fa-arrow-right"></i></a>
                                    </li>
                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                
                                  
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                            
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            

                                
                                

                                
                                

                                

                                
                                
                                
                            
                        
                    </ul>
                </nav>
            </div>
        </div>
        <footer class="site-footer">
    <p>
        Created and maintained by <br/>
        <a href="http://joshlockhart.com/">Josh Lockhart</a>,
        <a href="https://www.donielsmith.com/" target="_blank">Andrew Smith</a>,
        <a href="http://akrabat.com/" target="_blank">Rob Allen</a>,
        <a href="http://www.lgse.com/" target="_blank">Pierre Bérubé</a>, and the
        <a href="https://github.com/orgs/slimphp/people" target="_blank">Slim Framework Team</a>
    </p>
    <a alt="Donate with PayPal" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=9YRVXHRZT6H3L">Donate with PayPal</a>
</footer>

    </div>
</div>
        
        
        
        
        
        
        
        
    




</body><!-- Mirrored from www.slimframework.com/docs/v4/concepts/middleware.html by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 04 Dec 2020 20:50:26 GMT --></html>